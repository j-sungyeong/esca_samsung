# OV7670 camera with Zedboard, using VGA output

This document refers to http://www.nazim.ru/2512. Change its VHDL code to Systemverilog code.

## Getting started
This document is based on the requirements below.

- Windows 10
- Vivado Design Suite 2019.1
- Xilinx Zedboard
- VGA to VGA port with monitor

Also checked working normally at

- Ubuntu 20.04
- Vivado Design Suite 2018.3 / 2019.1
- Xilinx Zedboard
- VGA to VGA port with monitor


## 1. Create project

### 1. Create new Vivado project

1. Open the Vivado and click the 'create project' in 'Quick Start'.
2. Choose project type as RTL Project. 
3. At add sources, add systemverilog files(.sv files) in this git directory.
4. At add constraints, add 'zed_board.xdc' file in this git directory.
5. At default part, click 'boards' at top left corner, search ZedBoard and choose it.


### 2. Add Xilinx IPs for project.

The project uses some Xilinx ips about clk and memory. The Used IPs are

- one clock wizard
- three block memory generator

Click the 'Flow Navigator'/'PROJECT MANAGER'/'IP Catalog' at the left. Search 'clocking wizard' on IP catalog.

1. Create clocking wizard with

This clocking wizard gets zedboard clock and change it to various clocks.
	- Component Name : clk_wiz_0(this is default name if you create clocking wizard for first time)
	- Input Clock : name - clk_in_wiz / frequency - 100MHz
	- Output Clock1 : name - clk_100wiz / frequency - 100MHz
	- Output Clock2 : name - clk_75wiz / frequency - 75MHz
	- Output Clock3 : name - clk_50wiz / frequency - 50MHz
	- Output Clock4 : name - clk_25wiz / frequency - 25MHz

2. Create first block memeory generator with

This block memory stores image from ov7670_capture and send it to cv_core.
	- Component Name : blk_mem_gen_0(this is default name if you create clocking wizard for first time)
	- Memory Type : Simple Dual Port RAM
	- Port A Options : Port A Width - 8 / Port A Depth - 307200 / Enable Port Type - Always Enabled
	- Port B Options : Port B Width - 8 / Port B Depth - 307200 / Enable Port Type - Always Enabled

3. Create second block memeory generator with

This block memory stores image from cv_core and send it to vga.
	- Component Name : blk_mem_gen_1(this is default name if you create clocking wizard for second time)
	- Memory Type : Simple Dual Port RAM
	- Port A Options : Port A Width - 4 / Port A Depth - 307200 / Enable Port Type - Always Enabled
	- Port B Options : Port B Width - 4 / Port B Depth - 307200 / Enable Port Type - Always Enabled

4. Create third block memeory generator with

This block memory stores data from cv_core. This data is not used for now.
	- Component Name : blk_mem_gen_2(this is default name if you create clocking wizard for third time)
	- Memory Type : Simple Dual Port RAM
	- Port A Options : Port A Width - 16 / Port A Depth - 1024 / Enable Port Type - Always Enabled
	- Port B Options : Port B of blk_mem_gen_2 is unused yet. So, you can set it as you want

### 3. Generate Bitstream

Before generating bitstream, you must run synthesis and implementation of the project. But, in Vivado, if you click generate bitstream, vivado suggest you to run synthesis and implementation before it. So, you can simply click generate bitstream to do all necessary jobs.

## 2. Connect hardwares

### 1. Connect OV7670 to Zedboard

You can connect it with 20 F/M socket jumper cable. See the below table to figure how to connect.

|ov7670|Zedboard|Zynq|Verilog|
|--------|--------|--------|--------|
|PWDN|JA1|Y11|OV7670_PWDN|
|D0|JA2|AA11|OV7670_D[0]|
|D2|JA3|Y10|OV7670_D[2]|
|D4|JA4|AA9|OV7670_D[4]|
|GND|JA5|GROUND|GND|
|3V3|JA6|3.3V|3.3V|
|RESET|JA7|AB11|OV7670_RESET|
|D1|JA8|AB10|OV7670_D[1]|
|D3|JA9|AB9|OV7670_D[3]|
|D5|JA10|AA8|OV7670_D[5]|
|-|-|-|-|
|D6|JB1|W12|OV7670_D[6]|
|MCLK|JB2|W11|OV7670_XCLK|
|HREF|JB3|V10|OV7670_HREF|
|SIOD|JB4|W8|OV7670_SIOD|
|-|JB5|-|-|
|-|JB6|-|-|
|D7|JB7|V12|OV7670_D[7]|
|PCLK|JB8|W10|OV7670_PCLK|
|VSYNC|JB9|V9|OV7670_VSYNC|
|SIOC|JB10|V8|OV7670_SIOC|

### 2. Connect Zedboard to PC

You can easily connect it with JTAG port using USB 2.0 cable.

### 3. Connect Zedobard to Monitor

We will use VGA output to send out the images. So, you can connect Zedboard with monitor use VGA port of Zedboard.
In my case, I use VGA to VGA cable to connect, but I think VGA to HDMI or VGA to DPI cable can also be used.

## 3. Upload bitstream to Zedboard

### 1. Turn on the Zedboard

Turn on the Zedboard. Make sure your connection is perfect.

### 2. open hardware manager

Click the 'PROGRAM AND DEBUG' / 'Open Hardware Manager' at the left side.

### 3. Open target

Click the Open target in green banner at upside. After that click the Auto Connect. Vivado will catch your Zedboard connect automatically.

### 4. Upload Bitstream

Click the Program device in green banner at upside. Vivado automatically set Bitstream file as the bitstream which is generated by your project. Click the program to upload the bitstream to Zedboard.

## 4. After Uploading

If you can see the screen shows some grayscaled image filmed by ov7670, the project is successfully build. If the screen is tilt to some direction in monitor, please try moving screen in monitor setting. Because we do not use I2C signal in VGA connection, our device do not change the setting of monitor output.

If your monitor doesn't show profer screen, please check below errors and solution.

- Before all solution, I modified zedboard switch to control some image feature on screen. Please turn off all switches on zedboard.

- Screen is just black

Please turn on the switch5 in zedboard. If green rectangle appears in monitor, your VGA connection is normal. Else, please check your VGA connection.

- Screen is just black and VGA connection is normal.

If your VGA connection is normal, there are some problem in ov7670 to Zedboard connection. First double check switch6 on zedboard is turned off. After that, double check your ov7670 cables are pinned in profer ports in Zedboard.

- Screen is just black, VGA connection is normal, and ov7670 cables are pinned in profer ports in Zedboard.

Maybe its just your cables are loose or broken. Move ov7670 in some directions and touch the cables between OV7670 and zedboard. 

- Screen is just black, VGA connection is normal, ov7670 cables are pinned in profer ports in Zedboard, and I think my cables are work well.

I can't help with that problem for now. Please contact me with email 1216kg@naver.com. I'll do my best to help you.

- Screen is not black, but its image is weird.

Some cables between OV7670 and Zedboard are pinned in long port. Please check it again.

## 5. Design

### 1. ov7670_top
Top module of this project.

### 2. debounce
Change long button input as 1 cycle signal.

### 3. capture
Get an image from ov7670 connections and save it to fb1, a block memory generator.

### 4. core
Process image before displaying. In this code, it changes center parts resolution and saves it to fb2 and fb3. fb2's data is used for VGA output. fb3's data is not used yet.

You can modify core to change the displayed output on screen. Please try anything you want.

### 5. vga
Load data from fb2 and display it to monitor.

### 6. controller
Setting ov7670's registers. It also can reset ov7670 setting, but for now, there are some bugs so it doesn't works well.

### 7. switches
swtich 7 : on - change resolution of center part / off - do nothing

switch 6 : on - pause the image 				 / off - do nothing

switch 5 : on - show border of center part 		 / off - do nothing 
